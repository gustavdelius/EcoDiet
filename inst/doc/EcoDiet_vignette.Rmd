---
title: "How to run the Ecodiet package"
author: "Heloise Thero"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{How to run the EcoDiet package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The goal of EcoDiet is to combine two sources of data: isotopic and stomachal data with priors based on the litterature to model the trophic links and diet matrix.

We will use an artificial dataset stored as a list of 8 elements, with isotopic and stomachal data from 10 trophic groups. The data was created to show how the EcoDiet package works. 

## Install the package

The first thing to do is to load the EcoDiet package. As it is only stored on GitHub for now, we need to use the `install_github` function from the `devtools` package to load it.

So we will first install and load the `devtools` package:

```{r, eval = FALSE}
install.packages("devtools")
library(devtools)

```

And now we can load the EcoDiet package:

```{r, eval = FALSE}
devtools::install_github("heloisethero/EcoDiet", auth_token='c570f1b55d68a8ae0fb38428155e19a426814d15')
```

```{r}
library(EcoDiet)

```

## Load the data

We will use the example data that is provided with the package. You can see it consists of a list of 10 elements, each containing an important data to run the EcoDiet model.

```{r}
names(ecodiet_example)

```

We first need to load and rearrange the data with the `load_data` function:

```{r}
preprocessed_data <- load_data(ecodiet_example)

```

## Rescale the stomachal data (optional)

If the occurrences in your stomachal data are too small, you may need to rescale them, i.e., to inrease them using the number of full stomachs as a reference. For that you can use the `rescale_stomach_data` function.

Here are our example stomachal data, and the number of full stomachs, before rescaling them:

```{r}
preprocessed_data$o
preprocessed_data$n_sca

```

And here are the stomachal data after they have been rescaled:

```{r}
preprocessed_data$o <- rescale_stomach_data(preprocessed_data$o, preprocessed_data$n_sca)
preprocessed_data$o

```

## Write the model

Then we need to write the model in the BUGS syntax. Currently there is only one configuration of the EcoDiet model, so no parameter is needed to write the model:

```{r}
model_def <- write_model()

```

After that, you can save the model in a .bug file to keep it:

```{r, eval = FALSE}
cat(model_def, file = "EcoDiet_model.bug")

```

## Specify initial values for the model

The next step is to initiate the variables, i.e., to define starting points from which to run the MCMC chains. Here the inialization is made with fixed numeric values, defined by some data statistics.

```{r}
inits <- initialize_model(preprocessed_data)

```

## Run the model

## Check the convergence

## Plot the results

## Environment on which this vignette has been run

```{r}
devtools::session_info()

```

