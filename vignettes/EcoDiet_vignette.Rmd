---
title: "How to run the Ecodiet package"
author: "Heloise Thero"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{How to run the EcoDiet package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The goal of EcoDiet is to combine two sources of data: isotopic and stomachal data with priors based on the litterature to model the trophic links and diet matrix.

We will use an artificial dataset stored as a list of 10 elements, including the isotopic and stomachal data from 10 trophic groups. The data was created to show how the EcoDiet package works. 

## Load the package

The first thing to do is to load the EcoDiet package.

```{r}
library(EcoDiet)
```

If you have an error, please try to reinstall everything following [the instructions in the README](https://github.com/heloisethero/EcoDiet/blob/master/README.md)

## Load the data

We will use the example data that is provided with the package. You can see it consists of a list of 10 elements, each containing an important data to run the EcoDiet model.

```{r}
names(ecodiet_example)
```

We first need to load and rearrange the data with the `load_data` function:

```{r}
data <- preprocess_data(ecodiet_example)
```

## Write the model

Then we need to write the model in the BUGS syntax. Currently there is only one configuration of the EcoDiet model, so no parameter is needed to write the model:

```{r}
model_string <- write_model()
```

After that, you can save the model in a .bug file to keep it:

```{r, eval = FALSE}
cat(model_string, file = "EcoDiet_model.bug")
```

## Run the model

The model will likely take a long time to run. So first we will do a little test by trying:
```{r}
mcmc_output <- run_model(textConnection(model_string), data)
```

If everything went smoothly, you can now try to run the model with enough iterations for your variables to converge:
```{r, eval = FALSE}
mcmc_output <- run_model(textConnection(model_string), data, n_iter = 1e+06)
```

If you see a convergence error, check the `convergence_problems` vignette.

## Save the model's results

If the model was long to run, the best is to save the whole MCMC list in a Rdata file:
```{r, eval = FALSE}
save(mcmc_output, file ="mcmc_output")
```
This way the model won't have to be re-run.

In Bayesian models, the parameters are modelled by a probability distributions. So here the model's outputs are the approximate probability distributions for the trophic links between species (LAMBDA parameters) and the diet estimates of a prey for a predator (PI parameters). To summarize these distributions, we can use point estimates like the mean or the median.

We can access the mean (and other statistics) of the variables with the `summary` function:

```{r}
mcmc_summary <- summary(mcmc_output)$statistics
print(mcmc_summary)
```

We can also see the quantiles of the distributions with the same function. The by-default quantiles are the 2.5%, 25%, 50%, 75% and 97.5% quantiles. Because the median is also the 50% quantile, we can thus access the median of the distributions this way:

```{r}
mcmc_quantiles <- summary(mcmc_output)$quantiles
print(mcmc_quantiles)
```

If needed, we can also change the by-default quantiles, for example to obtain the 5% and the 95% quantiles:

```{r}
mcmc_quantiles <- summary(mcmc_output, quantiles = c(0.05, 0.95))$quantiles
print(mcmc_quantiles)
```

Finally these summary informations can be saved as csv files with the `write_csv` function:

```{r, eval = FALSE}
write.csv(mcmc_summary, file = "mcmc_summary.csv")
write.csv(mcmc_quantiles, file = "mcmc_quantiles.csv")
```

## Plot the results

## Environment on which this vignette has been run

```{r}
devtools::session_info()
```

