---
title: "How to run the Ecodiet package"
author: "Heloise Thero"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{How to run the EcoDiet package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The goal of EcoDiet is to combine two sources of data: isotopic and stomachal data with priors based on the litterature to model the trophic links and diet matrix.

We will use an artificial dataset stored as a list of 10 elements, including the isotopic and stomachal data from 10 trophic groups. The data was created to show how the EcoDiet package works. 

## Load the package

The first thing to do is to load the EcoDiet package.

```{r}
library(EcoDiet)

```

If you have an error, please try to reinstall everything following [the instructions in the README](https://github.com/heloisethero/EcoDiet/blob/master/README.md)

## Load the data

We will use the example data that is provided with the package. You can see it consists of a list of 10 elements, each containing an important data to run the EcoDiet model.

```{r}
names(ecodiet_example)

```

We first need to load and rearrange the data with the `load_data` function:

```{r}
preprocessed_data <- load_data(ecodiet_example)

```


## Write the model

Then we need to write the model in the BUGS syntax. Currently there is only one configuration of the EcoDiet model, so no parameter is needed to write the model:

```{r}
model_string <- write_model()

```

After that, you can save the model in a .bug file to keep it:

```{r, eval = FALSE}
cat(model_string, file = "EcoDiet_model.bug")

```

## Specify initial values for the model

The next step is to initiate the variables, i.e., to define starting points from which to run the MCMC chains. Here the inialization is made with fixed numeric values, defined by some data statistics.

```{r}
inits <- initialize_model(preprocessed_data, ecodiet_example$topo_run)

```

## Run the model

The model can now be run directly through the model definition string generated earlier:
```{r}
mcmc_output <- run_model(preprocessed_data, inits, textConnection(model_string))

```

The model can also be run from the model definition BUGS file:
```{r, eval = FALSE}
mcmc_output <- run_model(preprocessed_data, inits, "EcoDiet_model.bug")

```

The model's output can then be saved in a Rdata file:
```{r, eval = FALSE}
save(mcmc_output, file ="test_mcmc_output")
```


## Environment on which this vignette has been run

```{r}
devtools::session_info()

```

